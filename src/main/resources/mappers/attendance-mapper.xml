<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="attendanceMapper">

	<resultMap id="attendanceResultSet" type="Attendance">
		<id column="ATT_NO" property="attendanceNo"/>
		<result column="EMP_ID" property="empId"/>
		<result column="ATT_STATUS_NO" property="attStatusNo"/> 
		<result column="ATT_STATUS_NAME" property="attStatusName"/>
		<result column="ATT_DATE" property="attendanceDate"/>
		<result column="ATT_INTIME" property="attendanceInTime"/>
		<result column="ATT_OUTTIME" property="attendanceOutTime"/>	
			
	</resultMap>

	
	<resultMap id="attStatusResultSet" type="AttStatus">
		<id column="ATT_STATUS_NO" property="attStatusNo"/>
		<result column="ATT_STATUS_NAME" property="attStatusName"/>			
	</resultMap>

	<select id="selectAttStatus" resultMap="attStatusResultSet">
	SELECT * FROM ATT_STATUS	
	</select>
	
	<insert id="insertIntime" parameterType="Employee">
		insert into attendance (ATT_NO,EMP_ID,ATT_DATE,ATT_INTIME)
		values(SEQ_ATNO.nextval,#{empId},sysdate,sysdate)
	</insert>
	
	<select id="selectIntime" parameterType="Employee" resultMap="attendanceResultSet">
	SELECT * FROM ATTENDANCE 
	WHERE EMP_ID=#{empId} and TO_CHAR(SYSDATE, 'YY/MM/DD') = TO_CHAR(ATT_DATE, 'YY/MM/DD')
	</select>
	
	<select id="selectAttMy" parameterType="Member" resultMap="attendanceResultSet">
	SELECT * FROM ATTENDANCE 
	WHERE EMP_ID=#{empId}
	ORDER BY ATT_DATE 
	</select>
	
	<select id="selectAttDay" parameterType="Attendance" resultMap="attendanceResultSet">
	SELECT ATT_DATE, ATT_INTIME, ATT_OUTTIME,  ATT_STATUS_NAME 
	FROM ATTENDANCE
	JOIN ATT_STATUS USING (ATT_STATUS_NO)
	WHERE ATT_STATUS_NO =#{attStatusNo} 
	AND TO_CHAR(ATT_DATE, 'YYYY-MM-dd') = #{attendanceDate}
	
	</select>
</mapper>
